{{- if and (.Values.clickhouse.persistentVolume.enable) (eq (.Values.clickhouse.persistentVolume.provisioner) "Local") }}
apiVersion: v1
kind: PersistentVolume
metadata:
  name: clickhouse-pv
spec:
  storageClassName: clickhouse-storage
  capacity:
    storage: {{ .Values.clickhouse.storageSize }}
  accessModes:
    - ReadWriteOnce
  volumeMode: Filesystem
  local:
    path: {{ .Values.clickhouse.persistentVolume.localPath }}
  {{- with .Values.clickhouse.persistentVolume.affinity }}
  nodeAffinity:
    {{- toYaml . | trim | nindent 4 }}
  {{- end }}
{{- end }}
